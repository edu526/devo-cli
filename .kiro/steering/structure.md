---
inclusion: always
---

# Project Structure & Architecture

## Core Directory Structure

All source code lives in `cli_tool/` package:

- `cli_tool/cli.py` - CLI entry point, command registration with Click
- `cli_tool/config.py` - AWS Bedrock models, paths, configuration
- `cli_tool/_version.py` - Auto-generated from git tags (NEVER edit manually)
- `cli_tool/commands/` - Each CLI command as separate module
- `cli_tool/agents/` - AI agent base classes (BaseAgent wrapper)
- `cli_tool/templates/` - Jinja2 templates (*.j2 extension)
- `cli_tool/ui/` - Rich-based terminal UI components
- `cli_tool/utils/` - Shared utilities (AWS, git, templates)

## Architecture Patterns

### Adding New CLI Commands
1. Create module in `cli_tool/commands/` (e.g., `my_command.py`)
2. Define Click command with decorators for options/arguments
3. Register in `cli_tool/cli.py` using `cli.add_command()`
4. Follow existing command structure for consistency

### AI Agent Pattern
- Extend `BaseAgent` from `cli_tool/agents/base_agent.py`
- Use Pydantic models for structured outputs
- Define system prompts inline or in dedicated prompt modules
- For complex features, create subdirectory with `prompt/` folder (see `code_reviewer/`)

### Template-Based Generation
- Store Jinja2 templates in `cli_tool/templates/` with `.j2` extension
- Use `cli_tool/utils/templates.py` for rendering
- Templates must be included in `setup.py` package_data

### Feature Modules
Large features get their own subdirectory under `cli_tool/`:
- Main logic files (e.g., `analyzer.py`, `git_utils.py`)
- `prompt/` subdirectory for AI prompts
- `tools/` subdirectory for feature-specific tools
- Example: `cli_tool/code_reviewer/`

## Naming Conventions (REQUIRED)

- Python modules: `snake_case` (e.g., `commit_prompt.py`)
- Classes: `PascalCase` (e.g., `BaseAgent`, `CommitMessageResponse`)
- Functions/methods: `snake_case` (e.g., `get_staged_diff()`)
- Constants: `UPPER_SNAKE_CASE` (e.g., `BEDROCK_MODEL_ID`)
- Private members: prefix `_` (e.g., `_internal_method`)
- Templates: `descriptive_name.txt.j2`

## Git Workflow

- Branch format: `feature/NDT-<ticket_number>-description`
- Commit format: `<type>(<scope>): NDT-<ticket> <summary>` (max 50 chars)
- Types: feat, fix, chore, docs, refactor, test, style, perf
- Ticket numbers auto-extracted from branch names

## Critical Files (DO NOT MODIFY)

- `cli_tool/_version.py` - Auto-generated by setuptools_scm from git tags
- `.editorconfig` - Code style: 2 spaces, LF line endings
- `.flake8` - Line length: 150 chars

## Testing

- Tests in `tests/` directory
- Prefix test files with `test_` (e.g., `test_commit_prompt.py`)
- Use pytest and pytest-mock
- Tests should mirror package structure

## Package Distribution

- Entry point: `devo` console script defined in `setup.py`
- Non-Python files (templates, configs) specified in `setup.py` package_data
- Version from git tags via setuptools_scm
